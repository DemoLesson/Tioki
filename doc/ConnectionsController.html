<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: ConnectionsController
  
    &mdash; Documentation by YARD 0.8.2.1
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (C)</a> &raquo;
    
    
    <span class="title">ConnectionsController</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: ConnectionsController
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActionController::Base</li>
          
            <li class="next"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></li>
          
            <li class="next">ConnectionsController</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">app/controllers/connections_controller.rb</dd>
  
</dl>
<div class="clear"></div>








  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#accept_connection-instance_method" title="#accept_connection (instance method)">- (Object) <strong>accept_connection</strong>(respond = false) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Accept a connection invitation.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_and_redir-instance_method" title="#add_and_redir (instance method)">- (Object) <strong>add_and_redir</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_connection-instance_method" title="#add_connection (instance method)">- (Object) <strong>add_connection</strong>(respond = true) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#destroy-instance_method" title="#destroy (instance method)">- (Object) <strong>destroy</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>DELETE /connections/1 DELETE /connections/1.json.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#distance-instance_method" title="#distance (instance method)">- (Object) <strong>distance</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#index-instance_method" title="#index (instance method)">- (Object) <strong>index</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET /connections GET /connections.json.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inviteconnection-instance_method" title="#inviteconnection (instance method)">- (Object) <strong>inviteconnection</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inviteconnections-instance_method" title="#inviteconnections (instance method)">- (Object) <strong>inviteconnections</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#linkinvite-instance_method" title="#linkinvite (instance method)">- (Object) <strong>linkinvite</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#my_connections-instance_method" title="#my_connections (instance method)">- (Object) <strong>my_connections</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new_connections-instance_method" title="#new_connections (instance method)">- (Object) <strong>new_connections</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pending_connections-instance_method" title="#pending_connections (instance method)">- (Object) <strong>pending_connections</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>FOR old user connect emails.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_connection-instance_method" title="#remove_connection (instance method)">- (Object) <strong>remove_connection</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Remove any connections between two users.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_pending-instance_method" title="#remove_pending (instance method)">- (Object) <strong>remove_pending</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Remove any pending connections.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#show_my_connections-instance_method" title="#show_my_connections (instance method)">- (Object) <strong>show_my_connections</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#userconnections-instance_method" title="#userconnections (instance method)">- (Object) <strong>userconnections</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#welcome_wizard_invite-instance_method" title="#welcome_wizard_invite (instance method)">- (Object) <strong>welcome_wizard_invite</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ApplicationController.html#belongs_to_me-instance_method" title="ApplicationController#belongs_to_me (method)">#belongs_to_me</a></span>, <span class='object_link'><a href="ApplicationController.html#check_if_referer-instance_method" title="ApplicationController#check_if_referer (method)">#check_if_referer</a></span>, <span class='object_link'><a href="ApplicationController.html#check_login_token-instance_method" title="ApplicationController#check_login_token (method)">#check_login_token</a></span>, <span class='object_link'><a href="ApplicationController.html#current_user-instance_method" title="ApplicationController#current_user (method)">#current_user</a></span>, <span class='object_link'><a href="ApplicationController.html#get_analytics-instance_method" title="ApplicationController#get_analytics (method)">#get_analytics</a></span>, <span class='object_link'><a href="ApplicationController.html#is_admin-instance_method" title="ApplicationController#is_admin (method)">#is_admin</a></span>, <span class='object_link'><a href="ApplicationController.html#log_analytic-instance_method" title="ApplicationController#log_analytic (method)">#log_analytic</a></span>, <span class='object_link'><a href="ApplicationController.html#login_required-instance_method" title="ApplicationController#login_required (method)">#login_required</a></span>, <span class='object_link'><a href="ApplicationController.html#redirect_to_stored-instance_method" title="ApplicationController#redirect_to_stored (method)">#redirect_to_stored</a></span></p>

  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="accept_connection-instance_method">
  
    - (<tt>Object</tt>) <strong>accept_connection</strong>(respond = false) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Accept a connection invitation</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/connections_controller.rb', line 119</span>

<span class='kw'>def</span> <span class='id identifier rubyid_accept_connection'>accept_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_respond'>respond</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>

	<span class='comment'># Set A and B
</span>	<span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
	<span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:user_id</span><span class='rbracket'>]</span>

	<span class='comment'># Get the connection in question (A &lt;-&gt; B)
</span>	<span class='ivar'>@connect</span> <span class='op'>=</span> <span class='const'>Connection</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>(`owned_by` = ? &amp;&amp; `user_id` = ?) || (`user_id` = ? &amp;&amp; `owned_by` = ?)</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='comma'>,</span> <span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>

	<span class='comment'># Make the connection no longer pending
</span>	<span class='ivar'>@connect</span><span class='period'>.</span><span class='id identifier rubyid_pending'>pending</span> <span class='op'>=</span> <span class='kw'>false</span>

	<span class='comment'># If the connection saves
</span>	<span class='kw'>if</span> <span class='ivar'>@connect</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>

		<span class='const'>Whiteboard</span><span class='period'>.</span><span class='id identifier rubyid_createActivity'>createActivity</span><span class='lparen'>(</span><span class='symbol'>:user_connection</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>{user.teacher.profile_link} just connected with {tag.teacher.profile_link} you should too!</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span> <span class='op'>==</span> <span class='ivar'>@connect</span><span class='period'>.</span><span class='id identifier rubyid_user_id'>user_id</span> <span class='op'>?</span> <span class='ivar'>@connect</span><span class='period'>.</span><span class='id identifier rubyid_owned_by'>owned_by</span> <span class='op'>:</span> <span class='ivar'>@connect</span><span class='period'>.</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span><span class='rparen'>)</span>
		<span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_log_analytic'>log_analytic</span><span class='lparen'>(</span><span class='symbol'>:user_connection_accepted</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Two users connection</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@connect</span><span class='rparen'>)</span>

		<span class='comment'># Redirect to My Connections page
</span>		<span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
			<span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='symbol'>:my_connections</span> <span class='rbrace'>}</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="add_and_redir-instance_method">
  
    - (<tt>Object</tt>) <strong>add_and_redir</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/connections_controller.rb', line 165</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_and_redir'>add_and_redir</span>

	<span class='comment'># Make sure we have a user_id
</span>	<span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='id identifier rubyid_raise'>raise</span> <span class='const'>StandardError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Were missing the user id to connect to</span><span class='tstring_end'>&quot;</span></span>
	<span class='kw'>end</span>

	<span class='comment'># Make sure we have a redirection url
</span>	<span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>redir</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='id identifier rubyid_raise'>raise</span> <span class='const'>StandardError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>We can't redirect you anywhere unless you provide us with the url</span><span class='tstring_end'>&quot;</span></span>
	<span class='kw'>end</span>

	<span class='comment'># Create the connection and redirect
</span>	<span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_connection'>add_connection</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>redir</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="add_connection-instance_method">
  
    - (<tt>Object</tt>) <strong>add_connection</strong>(respond = true) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/connections_controller.rb', line 31</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_connection'>add_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_respond'>respond</span> <span class='op'>=</span> <span class='kw'>true</span><span class='rparen'>)</span>
	<span class='comment'># Check and see if we are already connected (or are pending)
</span>	<span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
	<span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:user_id</span><span class='rbracket'>]</span>
	<span class='ivar'>@previous</span> <span class='op'>=</span> <span class='const'>Connection</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>(`owned_by` = ? &amp;&amp; `user_id` = ?) || (`user_id` = ? &amp;&amp; `owned_by` = ?)</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='comma'>,</span> <span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>

	<span class='comment'># If we are not go ahead and initiate the connection
</span>	<span class='kw'>if</span> <span class='ivar'>@previous</span> <span class='op'>==</span> <span class='kw'>nil</span>

		<span class='comment'># Create the connection
</span>		<span class='ivar'>@connection</span> <span class='op'>=</span> <span class='const'>Connection</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='ivar'>@connection</span><span class='period'>.</span><span class='id identifier rubyid_owned_by'>owned_by</span> <span class='op'>=</span> <span class='id identifier rubyid_a'>a</span>
		<span class='ivar'>@connection</span><span class='period'>.</span><span class='id identifier rubyid_user_id'>user_id</span> <span class='op'>=</span> <span class='id identifier rubyid_b'>b</span>

		<span class='comment'># If everything saved ok
</span>		<span class='kw'>if</span> <span class='ivar'>@connection</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>

			<span class='comment'># If we suggested the connection log it as an analytic
</span>			<span class='kw'>unless</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:data</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:data</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:suggested_connection</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
				<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:data</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>suggested_connection</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_b'>b</span>
				<span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_log_analytic'>log_analytic</span><span class='lparen'>(</span><span class='symbol'>:suggested_connection_created</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>A user created a connection based off our suggestion</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='ivar'>@connection</span><span class='rparen'>)</span>
			<span class='kw'>end</span>

			<span class='comment'># Notify the other user of my connection request
</span>			<span class='const'>UserMailer</span><span class='period'>.</span><span class='id identifier rubyid_userconnect'>userconnect</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_deliver'>deliver</span>

			<span class='comment'># If respond is set to true then lets redirect
</span>			<span class='kw'>if</span> <span class='id identifier rubyid_respond'>respond</span>

				<span class='comment'># Redirect to &quot;My Connections&quot;
</span>				<span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
					<span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:to_wizard</span><span class='rbracket'>]</span>
						<span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:_ak</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unlock_connection_request</span><span class='tstring_end'>&quot;</span></span>
						<span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/welcome_wizard?x=step2</span><span class='tstring_end'>'</span></span> <span class='rbrace'>}</span>
					<span class='kw'>else</span>
						<span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='symbol'>:back</span><span class='comma'>,</span> <span class='symbol'>:notice</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Connection request successfully sent.</span><span class='tstring_end'>&quot;</span></span>  <span class='rbrace'>}</span>
					<span class='kw'>end</span>
				<span class='kw'>end</span>
			<span class='kw'>end</span>
		<span class='kw'>end</span>

	<span class='comment'># Were actually still pending
</span>	<span class='kw'>elsif</span> <span class='ivar'>@previous</span><span class='period'>.</span><span class='id identifier rubyid_pending'>pending</span> <span class='op'>==</span> <span class='kw'>true</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@previous</span><span class='period'>.</span><span class='id identifier rubyid_user_id'>user_id</span> <span class='op'>=</span> <span class='id identifier rubyid_a'>a</span>

		<span class='comment'># Dry way of accepting the connection
</span>		<span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>accept_connection</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_respond'>respond</span><span class='rparen'>)</span>

	<span class='comment'># Whoops we're already connected
</span>	<span class='kw'>else</span>

		<span class='comment'># If respond is set to true then lets redirect
</span>		<span class='kw'>if</span> <span class='id identifier rubyid_respond'>respond</span>

			<span class='comment'># Redirect to &quot;My Connections&quot;
</span>			<span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
				<span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='symbol'>:back</span><span class='comma'>,</span> <span class='symbol'>:notice</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Connection request successfully sent.</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
			<span class='kw'>end</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="destroy-instance_method">
  
    - (<tt>Object</tt>) <strong>destroy</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>DELETE /connections/1 DELETE /connections/1.json</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


318
319
320
321
322
323
324
325
326</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/connections_controller.rb', line 318</span>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy'>destroy</span>
	<span class='ivar'>@connection</span> <span class='op'>=</span> <span class='const'>Connection</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@connection</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>

	<span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
		<span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_connections_url'>connections_url</span> <span class='rbrace'>}</span>
		<span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_json'>json</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_head'>head</span> <span class='symbol'>:ok</span> <span class='rbrace'>}</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="distance-instance_method">
  
    - (<tt>Object</tt>) <strong>distance</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


311
312
313
314</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/connections_controller.rb', line 311</span>

<span class='kw'>def</span> <span class='id identifier rubyid_distance'>distance</span>
	<span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='int'>117091</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_distance'>distance</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_render'>render</span> <span class='symbol'>:text</span> <span class='op'>=&gt;</span> <span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>nil</span><span class='tstring_end'>'</span></span> <span class='op'>:</span> <span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="index-instance_method">
  
    - (<tt>Object</tt>) <strong>index</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GET /connections GET /connections.json</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/connections_controller.rb', line 10</span>

<span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
	<span class='ivar'>@my_connections</span> <span class='op'>=</span> <span class='const'>Connection</span><span class='period'>.</span><span class='id identifier rubyid_mine'>mine</span><span class='lparen'>(</span><span class='symbol'>:pending</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_connection'>connection</span><span class='op'>|</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_not_me'>not_me</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='rbrace'>}</span>
	<span class='ivar'>@skills</span> <span class='op'>=</span> <span class='const'>Skill</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='comma'>,</span> <span class='symbol'>:order</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
	<span class='ivar'>@teachers</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>

	<span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:skill</span><span class='rbracket'>]</span>
		<span class='id identifier rubyid_teachers'>teachers</span> <span class='op'>=</span> <span class='const'>Teacher</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='comma'>,</span> <span class='symbol'>:include</span> <span class='op'>=&gt;</span> <span class='symbol'>:skills</span><span class='comma'>,</span> <span class='symbol'>:conditions</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>skills.id = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:skill</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_paginate'>paginate</span><span class='lparen'>(</span><span class='symbol'>:per_page</span> <span class='op'>=&gt;</span> <span class='int'>25</span><span class='comma'>,</span> <span class='symbol'>:page</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:page</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='kw'>else</span>
		<span class='id identifier rubyid_teachers'>teachers</span> <span class='op'>=</span> <span class='const'>Teacher</span><span class='period'>.</span><span class='id identifier rubyid_search'>search</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:connectsearch</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:topic</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_paginate'>paginate</span><span class='lparen'>(</span><span class='symbol'>:per_page</span> <span class='op'>=&gt;</span> <span class='int'>25</span><span class='comma'>,</span> <span class='symbol'>:page</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:page</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='kw'>end</span>
	<span class='id identifier rubyid_teachers'>teachers</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_teacher'>teacher</span><span class='op'>|</span>
		<span class='ivar'>@teacher</span> <span class='op'>=</span> <span class='id identifier rubyid_teacher'>teacher</span>
		<span class='ivar'>@teachers</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_render_to_string'>render_to_string</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>connections/new_connections</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:layout</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rparen'>)</span>
	<span class='kw'>end</span>

	<span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
		<span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='comment'># index.html.erb
</span>		<span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_json'>json</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='ivar'>@connections</span> <span class='rbrace'>}</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="inviteconnection-instance_method">
  
    - (<tt>Object</tt>) <strong>inviteconnection</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/connections_controller.rb', line 188</span>

<span class='kw'>def</span> <span class='id identifier rubyid_inviteconnection'>inviteconnection</span>
	<span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:emails</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:emails</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>0</span>
		<span class='kw'>return</span> <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='symbol'>:back</span><span class='comma'>,</span> <span class='symbol'>:notice</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Must have at least one email.</span><span class='tstring_end'>&quot;</span></span>
	<span class='kw'>end</span>

	<span class='id identifier rubyid_notice'>notice</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
	<span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:emails</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>,</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_email'>email</span><span class='op'>|</span>
		<span class='comment'># Clean up the email
</span>		<span class='id identifier rubyid_email'>email</span> <span class='op'>=</span> <span class='id identifier rubyid_email'>email</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>

		<span class='kw'>begin</span>
			<span class='comment'># Parse the email address
</span>			<span class='id identifier rubyid_mail'>mail</span> <span class='op'>=</span> <span class='const'>Mail</span><span class='op'>::</span><span class='const'>Address</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_email'>email</span><span class='rparen'>)</span>
			<span class='id identifier rubyid_demail'>demail</span> <span class='op'>=</span> <span class='id identifier rubyid_mail'>mail</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span>

			<span class='comment'># Find the user by the provided email
</span>			<span class='ivar'>@user</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='symbol'>:first</span><span class='comma'>,</span> <span class='symbol'>:conditions</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>email = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_email'>email</span><span class='rbracket'>]</span><span class='rparen'>)</span>

			<span class='comment'># If the user exists run a add connection
</span>			<span class='kw'>if</span> <span class='ivar'>@user</span> <span class='op'>!=</span> <span class='kw'>nil</span>

				<span class='comment'># Make sure the user has a teacher profile
</span>				<span class='kw'>if</span> <span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_teacher'>teacher</span>
					<span class='comment'># This connection is now like a normal connection request
</span>					<span class='kw'>if</span> <span class='const'>Connection</span><span class='period'>.</span><span class='id identifier rubyid_add_connect'>add_connect</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
						<span class='id identifier rubyid_notice'>notice</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Your connection request to </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_demail'>demail</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> has been sent.</span><span class='tstring_end'>&quot;</span></span>
					<span class='kw'>else</span>
						<span class='id identifier rubyid_notice'>notice</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_demail'>demail</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> has already been connected to.</span><span class='tstring_end'>&quot;</span></span>
					<span class='kw'>end</span>

					<span class='comment'># Notify the current session user
</span>
				<span class='comment'># If the user is not a teacher then do notify that a connection cannot be made
</span>				<span class='kw'>else</span>
					<span class='id identifier rubyid_notice'>notice</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_email'>email</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> cannot be connected with.</span><span class='tstring_end'>&quot;</span></span>
				<span class='kw'>end</span>

			<span class='comment'># If the email is not tied to a member then invite them
</span>			<span class='kw'>else</span>
				<span class='id identifier rubyid_url'>url</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_host_with_port'>host_with_port</span><span class='rbrace'>}</span><span class='tstring_content'>/dc/</span><span class='embexpr_beg'>#{</span><span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_invite_code'>invite_code</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>

				<span class='comment'># Send out the email
</span>				<span class='id identifier rubyid_mail'>mail</span> <span class='op'>=</span> <span class='const'>UserMailer</span><span class='period'>.</span><span class='id identifier rubyid_connection_invite'>connection_invite</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_current_user'>current_user</span><span class='comma'>,</span> <span class='id identifier rubyid_email'>email</span><span class='comma'>,</span> <span class='id identifier rubyid_url'>url</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_deliver'>deliver</span>

				<span class='comment'># Notify the current session member that ht e email was sent
</span>				<span class='id identifier rubyid_notice'>notice</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Your invite to </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_demail'>demail</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> has been sent.</span><span class='tstring_end'>&quot;</span></span>

				<span class='comment'># Log an analytic
</span>				<span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_log_analytic'>log_analytic</span><span class='lparen'>(</span><span class='symbol'>:connection_invite_sent</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User invited people to the site to connect.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@user</span><span class='rparen'>)</span>
			<span class='kw'>end</span>

			<span class='kw'>unless</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:wizard</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
				<span class='comment'># Wizard Key
</span>				<span class='id identifier rubyid_wKey'>wKey</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>welcome_wizard_step5</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:_ak</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>_[</span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:_ak</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>]</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>

				<span class='comment'># And create an analytic
</span>				<span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_log_analytic'>log_analytic</span><span class='lparen'>(</span><span class='id identifier rubyid_wKey'>wKey</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User completed step 5 of the welcome wizard.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_current_user'>current_user</span><span class='rparen'>)</span>

				<span class='comment'># Delete this identifier
</span>				<span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:wizard</span><span class='rparen'>)</span>
			<span class='kw'>end</span>

		<span class='comment'># If the email could not be parsed let the current session member know
</span>		<span class='kw'>rescue</span> <span class='const'>Mail</span><span class='op'>::</span><span class='const'>Field</span><span class='op'>::</span><span class='const'>ParseError</span>
			<span class='id identifier rubyid_notice'>notice</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not parse </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_email'>email</span>
		<span class='kw'>rescue</span>
			<span class='id identifier rubyid_notice'>notice</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unknown Error</span><span class='tstring_end'>&quot;</span></span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>

	<span class='comment'># Take us home
</span>	<span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='symbol'>:root</span><span class='comma'>,</span> <span class='symbol'>:notice</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_notice'>notice</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'> </span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="inviteconnections-instance_method">
  
    - (<tt>Object</tt>) <strong>inviteconnections</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


182
183
184
185
186</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/connections_controller.rb', line 182</span>

<span class='kw'>def</span> <span class='id identifier rubyid_inviteconnections'>inviteconnections</span>
	<span class='ivar'>@referred</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_successful_referrals'>successful_referrals</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>
	<span class='ivar'>@my_connection</span> <span class='op'>=</span> <span class='const'>Connection</span><span class='period'>.</span><span class='id identifier rubyid_find_for_user'>find_for_user</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
	<span class='ivar'>@default_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hey! I'd absolutely love to add you to my educator network on Tioki.</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="linkinvite-instance_method">
  
    - (<tt>Object</tt>) <strong>linkinvite</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


262
263
264
265
266
267
268
269</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/connections_controller.rb', line 262</span>

<span class='kw'>def</span> <span class='id identifier rubyid_linkinvite'>linkinvite</span>
	<span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='symbol'>:first</span><span class='comma'>,</span> <span class='symbol'>:conditions</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>users.invite_code = ?</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:url</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span>
		<span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/welcome_wizard?x=step1&amp;invitecode=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_invite_code'>invite_code</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
	<span class='kw'>else</span> 
		<span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/welcome_wizard?x=step1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:notice</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid invite code.</span><span class='tstring_end'>&quot;</span></span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="my_connections-instance_method">
  
    - (<tt>Object</tt>) <strong>my_connections</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


144
145
146
147
148
149
150
151
152</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/connections_controller.rb', line 144</span>

<span class='kw'>def</span> <span class='id identifier rubyid_my_connections'>my_connections</span>
	<span class='comment'># Get all not pending connections
</span>	<span class='ivar'>@connections</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	<span class='const'>Connection</span><span class='period'>.</span><span class='id identifier rubyid_mine'>mine</span><span class='lparen'>(</span><span class='symbol'>:pending</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_paginate'>paginate</span><span class='lparen'>(</span><span class='symbol'>:per_page</span> <span class='op'>=&gt;</span> <span class='int'>5</span><span class='comma'>,</span> <span class='symbol'>:page</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:page</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_connection'>connection</span><span class='op'>|</span>
		<span class='ivar'>@connection</span> <span class='op'>=</span> <span class='id identifier rubyid_connection'>connection</span>
		<span class='ivar'>@connections</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_render_to_string'>render_to_string</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>connections/show_my_connections</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:layout</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rparen'>)</span>
	<span class='kw'>end</span>
	<span class='ivar'>@my_pending_connections</span> <span class='op'>=</span> <span class='const'>Connection</span><span class='period'>.</span><span class='id identifier rubyid_mine'>mine</span><span class='lparen'>(</span><span class='symbol'>:pending</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbol'>:creator</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new_connections-instance_method">
  
    - (<tt>Object</tt>) <strong>new_connections</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/connections_controller.rb', line 293</span>

<span class='kw'>def</span> <span class='id identifier rubyid_new_connections'>new_connections</span>
	<span class='ivar'>@my_connections</span> <span class='op'>=</span> <span class='const'>Connection</span><span class='period'>.</span><span class='id identifier rubyid_mine'>mine</span><span class='lparen'>(</span><span class='symbol'>:pending</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_connection'>connection</span><span class='op'>|</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_not_me'>not_me</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='rbrace'>}</span>
	<span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:skill</span><span class='rbracket'>]</span>
		<span class='id identifier rubyid_teachers'>teachers</span> <span class='op'>=</span> <span class='const'>Teacher</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='comma'>,</span> <span class='symbol'>:include</span> <span class='op'>=&gt;</span> <span class='symbol'>:skills</span><span class='comma'>,</span> <span class='symbol'>:conditions</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>skills.id = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:skill</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_paginate'>paginate</span><span class='lparen'>(</span><span class='symbol'>:per_page</span> <span class='op'>=&gt;</span> <span class='int'>25</span><span class='comma'>,</span> <span class='symbol'>:page</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:page</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='kw'>else</span>
		<span class='id identifier rubyid_teachers'>teachers</span> <span class='op'>=</span> <span class='const'>Teacher</span><span class='period'>.</span><span class='id identifier rubyid_search'>search</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:connectsearch</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:topic</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_paginate'>paginate</span><span class='lparen'>(</span><span class='symbol'>:per_page</span> <span class='op'>=&gt;</span> <span class='int'>25</span><span class='comma'>,</span> <span class='symbol'>:page</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:page</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='kw'>end</span>
	<span class='kw'>return</span> <span class='id identifier rubyid_render'>render</span> <span class='symbol'>:json</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_connections'>connections</span> <span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:raw</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

	<span class='id identifier rubyid_divs'>divs</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	<span class='id identifier rubyid_teachers'>teachers</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_teacher'>teacher</span><span class='op'>|</span>
		<span class='ivar'>@teacher</span> <span class='op'>=</span> <span class='id identifier rubyid_teacher'>teacher</span>
		<span class='id identifier rubyid_divs'>divs</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_render_to_string'>render_to_string</span>
	<span class='kw'>end</span>

	<span class='id identifier rubyid_render'>render</span> <span class='symbol'>:json</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_divs'>divs</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pending_connections-instance_method">
  
    - (<tt>Object</tt>) <strong>pending_connections</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>FOR old user connect emails</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


155
156
157</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/connections_controller.rb', line 155</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pending_connections'>pending_connections</span>
	<span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/my_connections</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove_connection-instance_method">
  
    - (<tt>Object</tt>) <strong>remove_connection</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Remove any connections between two users</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/connections_controller.rb', line 101</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remove_connection'>remove_connection</span>

	<span class='comment'># Set A and B
</span>	<span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
	<span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:user_id</span><span class='rbracket'>]</span>

	<span class='comment'># Delete both A -&gt; B and B -&gt; A (If we missed any duplicated records)
</span>	<span class='const'>Connection</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>(`owned_by` = ? &amp;&amp; `user_id` = ?) || (`user_id` = ? &amp;&amp; `owned_by` = ?)</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='comma'>,</span> <span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span>
		<span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
	<span class='kw'>end</span>
	
	<span class='comment'># Return to my connections
</span>	<span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
		<span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='symbol'>:my_connections</span> <span class='rbrace'>}</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove_pending-instance_method">
  
    - (<tt>Object</tt>) <strong>remove_pending</strong>(*args) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Remove any pending connections</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


94
95
96
97
98</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/connections_controller.rb', line 94</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remove_pending'>remove_pending</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>

	<span class='comment'># Redirect to remove connection since it is an unbiased connection removed and would do this anyway
</span>	<span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>remove_connection</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="show_my_connections-instance_method">
  
    - (<tt>Object</tt>) <strong>show_my_connections</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


280
281
282
283
284
285
286
287
288
289
290
291</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/connections_controller.rb', line 280</span>

<span class='kw'>def</span> <span class='id identifier rubyid_show_my_connections'>show_my_connections</span>
	<span class='id identifier rubyid_connections'>connections</span> <span class='op'>=</span> <span class='const'>Connection</span><span class='period'>.</span><span class='id identifier rubyid_mine'>mine</span><span class='lparen'>(</span><span class='symbol'>:pending</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_paginate'>paginate</span><span class='lparen'>(</span><span class='symbol'>:per_page</span> <span class='op'>=&gt;</span> <span class='int'>5</span><span class='comma'>,</span> <span class='symbol'>:page</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:page</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
	<span class='kw'>return</span> <span class='id identifier rubyid_render'>render</span> <span class='symbol'>:json</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_connections'>connections</span> <span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:raw</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

	<span class='id identifier rubyid_divs'>divs</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
	<span class='id identifier rubyid_connections'>connections</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_connection'>connection</span><span class='op'>|</span>
		<span class='ivar'>@connection</span> <span class='op'>=</span> <span class='id identifier rubyid_connection'>connection</span>
		<span class='id identifier rubyid_divs'>divs</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_render_to_string'>render_to_string</span>
	<span class='kw'>end</span>

	<span class='id identifier rubyid_render'>render</span> <span class='symbol'>:json</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_divs'>divs</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="userconnections-instance_method">
  
    - (<tt>Object</tt>) <strong>userconnections</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


159
160
161
162
163</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/connections_controller.rb', line 159</span>

<span class='kw'>def</span> <span class='id identifier rubyid_userconnections'>userconnections</span>
	<span class='ivar'>@user</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@connections</span> <span class='op'>=</span> <span class='const'>Connection</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='ivar'>@my_connections</span> <span class='op'>=</span> <span class='const'>Connection</span><span class='period'>.</span><span class='id identifier rubyid_mine'>mine</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="welcome_wizard_invite-instance_method">
  
    - (<tt>Object</tt>) <strong>welcome_wizard_invite</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


271
272
273
274
275
276
277
278</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/connections_controller.rb', line 271</span>

<span class='kw'>def</span> <span class='id identifier rubyid_welcome_wizard_invite'>welcome_wizard_invite</span>
	<span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='symbol'>:first</span><span class='comma'>,</span> <span class='symbol'>:conditions</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>users.invite_code = ?</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:url</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span>
		<span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/welcome_wizard?x=step1&amp;welcomecode=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_invite_code'>invite_code</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
	<span class='kw'>else</span> 
		<span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/welcome_wizard?x=step1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:notice</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid invite code.</span><span class='tstring_end'>&quot;</span></span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Thu Oct 11 16:47:24 2012 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.2.1 (ruby-1.9.3).
</div>

  </body>
</html>