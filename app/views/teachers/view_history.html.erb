<script type="text/javascript" src="/uncompiled/flot/jquery.flot.min.js"></script>
<script type="text/javascript" src="/uncompiled/flot/jquery.flot.selection.min.js"></script>

<span style="font-size:20px; font-family: Arial, Helvetica, 'Nimbus Sans L', sans-serif; color:#000; text-shadow:#ccc 1px 1px 2px;">Profile View History</span><br />

<div id="sidebar" class="job_browser">
	<div id="myConnections">
			<img src="/assets/contacts.png" id = "myConnectionsPic" class = "icon" width = "34" alt="contacts.png"/>
			<h4>View History</h4>
		Profile View's (<%= @viewed.count.to_s %>)
	</div>
</div>

<div id="content">

<h1>In the past week</h1>

<div id="last_week" style="width:680px;height:250px;"></div>

<div id="last_week_overview" style="width:680px;height:50px;"></div>

<!-- Load Plot Points -->
<script type="text/javascript">
$(function () {
		var d = [<%= @last_week %>];
		
		var options = {
				xaxis: { mode: "time", tickLength: 5, timeformat: "%b %0d" },
				yaxis: {
					autoscaleMargin: 2,
					tickFormatter: function(val, axis) {
						return val + ' Visitors';
					}
				},
				selection: { mode: "x" },
		};
		
		var plot = $.plot($("#last_week"), [d], options);
		
		var overview = $.plot($("#last_week_overview"), [d], {
				series: {
						lines: { show: true, lineWidth: 1 },
						shadowSize: 0
				},
				xaxis: { ticks: [], mode: "time" },
				yaxis: { ticks: [], min: 0, autoscaleMargin: 0.1 },
				selection: { mode: "x" }
		});

		// now connect the two
		$("#last_week").bind("plotselected", function (event, ranges) {
			// do the zooming
			plot = $.plot($("#last_week"), [d], $.extend(true, {}, options, {
				xaxis: { min: ranges.xaxis.from, max: ranges.xaxis.to }
			}));
			
			// don't fire event on the overview to prevent eternal loop
			overview.setSelection(ranges, true);
		});
		
		$("#last_week_overview").bind("plotselected", function (event, ranges) {
				plot.setSelection(ranges);
		});
});
</script>

<br />

<h1>Who has viewed your profile</h1>
<% @viewed.each do |connection| %>
	<br />
	<div class="item_jobs">
		<div class="item_picture">
			<% if connection.user.avatar? %>
				<%= link_to image_tag(connection.user.avatar.url(:thumb)), '/'+connection.user.teacher.url.to_s %>
			<% else %>
				<%= link_to image_tag("no_image.png"), '/'+connection.user.teacher.url.to_s %><% end %>
		</div>

		<div id ="connection_desc">
			<span style ="float:right; text-align:right"><%= link_to "Connections: " + connection.user.connections.count.to_s, 'userconnections/'+connection.user.id.to_s %></span>
		<strong><%= link_to connection.user.name, '/'+connection.user.teacher.url.to_s %></strong><br />
		<% if connection.user.teacher.position.present? && connection.user.teacher.school.present?%>
			<%= connection.user.teacher.position %> at <%= connection.user.teacher.school %>
		<% end %><br />
		<%= connection.user.teacher.location %><br />
		<div>
			<%= link_to "Send Message", { :controller => 'messages', :action => 'new', :user_id_to => connection.user.id.to_s }, {:class => "btn"} %>
		</div>
	</div>
	</div>
<% end %>
</div>