<section id="main-content" class="inner-content">
	
	<section class="info panel" style="height:180px;background-color:#FFF; border: 1px solid #ccc; border-radius: 0; margin:30px 0px 10px 0px">
			<section class="two-column right-side" style ="width:765px;margin:0px 10px 10px -100px">
				<!-- EDIT AND FOLLOW BUTTONS -->
				<% if self.current_user != nil %>
					<div style="float:right;margin-top:0px">
                    
					<!-- Connection Options -->
					<% # IF this is my profile allow me to edit %>
					<% if @self %>
						<a href="/me/profile/edit" class="action-button bg-salmon">
							Edit My Profile
						</a>
					<% # IF im not a user then let me register %>
					<% elsif !self.current_user %>
						<a href="/welcome_wizard?x=step1&user_connection=<%= @user.id %>" class="action-button bg-salmon">
							<%= ablang('connection.connect') %>
						</a>
					<% # IF we are already connected or if i am a school allow me to send a message %>
					<% elsif Connection.mine.collect{|x| x.not_me.id}.include? @user.id %>
						<%= link_to "Send Message", { :controller => 'messages', :action => 'new', :user_id_to => @user.id }, {:class => "action-button bg-salmon"} %>
					<% # IF we are not connected then display "connect" button %>
					<% else %>
						<%= link_to ablang('connection.connect'), { :controller => 'connections', :action => 'add_connection', :user_id => @user.id }, :class => "action-button bg-salmon" %>
					<% end %>
                    
                    <!-- If this is my profile provide a link to my public profile for me to share -->
					<% if @self %>
						<a href="/profile/<%= @user.slug %>" style="float:right;" class="button bg-green">My Public Profile</a>
					<% end %>
					</div>
				<% end %>

				<!-- START Teacher INFO -->
				<h2 style="margin: 10px 0px 10px 10px">
				<%= @user.name %>
				</h2>
				<section style= "height: 75px;">
				<% if @user.headline? %>
					<h4 style="margin-left:10px;margin-top:-10px;width:auto">
						"<%= @user.headline %>"
					</h4>
				<% end %>

				<p style="margin-left:10px; margin-top:-15px; margin-bottom: 5px; width:auto">
				  	<% if !(currentJob = @user.currentJob).nil? %>
						<strong style="color:#2AA99B">
							Currently:
						</strong> 
						<%= currentJob.position %> at <%= currentJob.company %> in  
					<% end %>
					<%= @user.location %>
				</p>
				</section>
				<p>
				<section id="updates" style="margin: 0px 0px 0px 10px;">
					<!-- SOCIAL LINKS -->
						<% if @self %>
							<a href="/my_connections" style= "margin-right:10px;">
							<div class="count connections" style= "margin-bottom:0px;">
							<%= User.current.pending_connections(false).count %>
							</div>
							<%= ablang('connection.plural') %>
							</a>
						<% else %>
							<a href="/profile/<%= @user.slug %>/connections" style= "margin-right:10px;">
							<div class="count connections" style= "margin-bottom:0px;">
							<%= @user.pending_connections(false).count %>
							</div>
							<%= ablang('connection.plural') %>
							</a>
						<% end %>
                        
                        <% social = @user.social %>
						<% if !social['twitter'].nil? %>
							<% if social['twitter'].include? '//' %>
								<%= link_to image_tag('tioki/icons/twitter2.png', :style=>"margin-top:-20px"), social['twitter'], :target => "_blank" %>
							<% elsif social['twitter'].include? 'twitter' %>
								<%= link_to image_tag('tioki/icons/twitter2.png', :style=>"margin-top:-20px"), '//' + social['twitter'], :target => "_blank" %>
							<% else %>
								<%= link_to image_tag('tioki/icons/twitter2.png', :style=>"margin-top:-20px"), '//twitter.com/' + social['twitter'], :target => "_blank" %>
							<% end %>
						<% end %>

						<% if !social['linkedin'].nil? %>
							<% if social['linkedin'].include? '//' %>
								<%= link_to image_tag('tioki/icons/LinkedIn_IN_Icon_25px.png', :border => 0, :style=>"margin-bottom:-0px; margin-left:10px; margin-top:-20px"), social['linkedin'], :target => "_blank" %>
							<% else %>
								<%= link_to image_tag('tioki/icons/LinkedIn_IN_Icon_25px.png', :border => 0, :style=>"margin-bottom:-0px; margin-left:10px; margin-top:-20px"), '//' + social['linkedin'], :target => "_blank" %>
							<% end %>
						<% end %>

						<% if !social['edmodo'].nil? %>
							<% if social['edmodo'].include? '//' %>
								<%= link_to image_tag('tioki/icons/edmodo.png', :style=>"margin-left:10px; margin-top:-20px"), social['edmodo'], :target => "_blank" %>
							<% else %>
								<%= link_to image_tag('tioki/icons/edmodo.png', :style=>"margin-left:10px; margin-top:-20px"), '//' + social['edmodo'], :target => "_blank" %>
							<% end %>
						<% end %>

						<% if !social['betterlesson'].nil? %>
							<% if social['betterlesson'].include? '//' %>
								<%= link_to image_tag('tioki/icons/betterlesson.png', :style=>"margin-left:10px; margin-top:-20px"), social['betterlesson'], :target => "_blank" %>
							<% else %>
								<%= link_to image_tag('tioki/icons/betterlesson.png', :style=>"margin-left:10px; margin-top:-20px"), '//' + social['betterlesson'], :target => "_blank" %>
							<% end %>
						<% end %>

						<% if !social['teachingchannel'].nil? %>
							<% if social['teachingchannel'].include? '//' %>
								<%= link_to image_tag('tioki/icons/teachingchannel.png', :style=>"margin-left:10px; margin-top:-20px"), social['teachingchannel'], :target => "_blank" %>
							<% else %>
								<%= link_to image_tag('tioki/icons/teachingchannel.png', :style=>"margin-left:10px; margin-top:-20px"), '//' + social['teachingchannel'], :target => "_blank" %>
							<% end %>
						<% end %>
						
						<% if !social['blog'].nil? %>
							<% if social['blog'].include? '//' %>
								<%= link_to image_tag('tioki/icons/blog_icon.png', :style=>"margin-left:10px; margin-top:-20px"), social['blog'], :target => "_blank" %>
							<% else %>
								<%= link_to image_tag('tioki/icons/blog_icon.png', :style=>"margin-left:10px; margin-top:-20px"), 'http://' + social['blog'], :target => "_blank" %>
							<% end %>
						<% end %>
						
						<% if !social['website'].nil? %>
							<% if social['website'].include? '//' %>
								<%= link_to image_tag('tioki/icons/globe.png', :style=>"margin-left:10px; margin-top:-20px"), social['website'], :target => "_blank" %>
							<% else %>
								<%= link_to image_tag('tioki/icons/globe.png', :style=>"margin-left:10px; margin-top:-20px"), 'http://' + social['website'], :target => "_blank" %>
							<% end %>
						<% end %>
				</section>
				</p>
			</section>
			<section class="profile-thumb-large" style="margin: 10px 0px 10px 10px;">
				<% if @self %>
					<a href="/me/profile/edit/upload-avatar" class="edit"><span class="iconic pen"></span> Edit</a>
				<% end %>
				<% if (@connected || @guest || !@user.privacy["avatar"]) && @user.avatar? %>
					<%= image_tag(@user.avatar.url(:medium), :width => "160") %>
				<% else %>
					<%= image_tag('dl_icons/no_avatar_large.jpg') %>
				<% end %>
			</section>
	</section>
	<h1>Profile View History</h1>

	<section class="profile group">
		<script type="text/javascript" src="/uncompiled/flot/jquery.flot.js"></script>

		<nav class="subpage">
			<ul>
				<li>
					<a href="/me/profile">
						Tioki Profile
					</a>
				</li>
				<!--li>
					<a href="terms.html">
					Card Profile
					</a>
				</li-->
				<li class="current">
					Profile Stats
				</li>
			</ul>
		</nav>

		<section class="sidebar">
			<div class="profile-thumb-large">
				<%= image_tag(@user.avatar.url(:medium), :width => "160") if @user.avatar? %>
				<%= image_tag('dl_icons/no_avatar_large.jpg') unless @user.avatar? %>
			</div>
			<h3><%= @user.name %></h3>
			<p><%= @user.headline %></p>
		</section>

		<section class="profile-content">	
			<section class="info panel">
				<h3>Profile views in the past week</h3>

				<section class="panel-actions">

					<div id="profile_last_week" style="width:600px;height:250px;margin:10px 10px;"></div>

					<!-- Load Plot Points -->
					<script type="text/javascript">
					$(function () {
						var d = [<%= @data['profile_last_week'] %>];
						
						var options = {
							xaxis: { 
								mode: "time",
								tickLength: 5,
								timeformat: "%b %0d",
								autoscaleMargin: 1,
							},
							yaxis: {
								autoscaleMargin: 2,
								tickFormatter: function(val, axis) {
									return val + ' Visitors';
								}
							},
							selection: { mode: "x" },
						};
						
						var plot = $.plot($("#profile_last_week"), [d], options);
					});
					</script>

				</section>
			</section>
			<section class="info panel">
				<h3>Who has viewed your profile</h3>
				<ul>
					<% @viewed.each do |view| %>
						<% if view.user.nil?; view.destroy; next; end; %>
						<li style="display:block;">
							<div class="profile-thumb-small" style="float:left;">
								<%= link_to image_tag(view.user.avatar.url(:tiny), :width => '45px', :height => '45px'), "/profile/#{view.user.slug}" if view.user.avatar? && !view.user.nil? %>
								<%= link_to image_tag("dl_icons/no_avatar_tiny.jpg"), "/profile/#{view.user.slug}" unless view.user.avatar? || view.user.nil? %>
							</div>
							<p style="float:none;">
								<%= link_to view.user.name, "/profile/#{view.user.slug}" unless view.user.nil? %><br />
								<%= view.user.location unless view.user.location.nil? || view.user.location.empty? %>
							</p>
						</li>
					<% end %>
				</ul>
			</section>
		</section>
	</section>
</section>