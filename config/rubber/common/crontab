<%
  @read_cmd = 'crontab -l'
  @write_cmd = 'crontab -'

  graylog_server = rubber_instances.for_role("graylog_server").first
  is_graylog_instance = rubber_instances[rubber_env.host].role_names.include?('graylog_server')
%>

# cron clears out environment variables, but Rubber.root/script/rubber uses
# "rvm do default" to run, so no longer any need to setup ruby env vars here,
# all we need is PATH
PATH=<%= ENV['PATH'] %>

MAILTO=<%= rubber_env.admin_email %>
# don't need to set RUBBER_ENV for each script since we set it for all cron here
RUBBER_ENV=<%= Rubber.env %>
RAILS_ENV=<%= Rubber.env %>

# Roll all rails logs at midnight
0 0 * * * <%= Rubber.root %>/script/rubber cron --task util:rotate_logs --directory=<%= Rubber.root %>/log

<% if graylog_server && !is_gray_log_instance %>
*/5 * * * * cd <%= rubber_env.graylog_web_dir %> && rake streamalarms:send
*/5 * * * * cd <%= rubber_env.graylog_web_dir %> && rake subscriptions:send
<% end %>